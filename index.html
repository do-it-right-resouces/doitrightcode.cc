<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DO IT RIGHT - Barcode Generator</title>
<script src="https://cdn.jsdelivr.net/npm/bwip-js@4.5.1/dist/bwip-js-min.js" integrity="sha384-OLBgp1GsljhM2TJ+sbHjaiH9txEUvgdDTAzHv2P24donTt6/529l+9Ua0vFImLlb" crossorigin="anonymous"></script>

<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Auth Overlay -->
<div id="auth-overlay" class="auth-overlay">
    <div class="auth-box">
        <div class="auth-logo-wrap">
            <img src="assets/logo.png" alt="DO IT RIGHT" class="logo-auth" id="auth-logo">
            <div id="auth-logo-smoke" class="smoke-container auth-smoke" aria-hidden="true"></div>
        </div>
        <h2 id="auth-title">Login</h2>
        <div id="auth-error" class="auth-error" style="display:none;"></div>
        <input type="email" id="auth-email" class="auth-input" placeholder="Email Address">
        <input type="password" id="auth-password" class="auth-input" placeholder="Password">
        <div id="register-fields" style="display:none;">
            <input type="password" id="auth-confirm" class="auth-input" placeholder="Confirm Password">
        </div>
        <button id="auth-submit" class="auth-btn">Login</button>
        <div id="auth-toggle" class="auth-toggle">Don't have an account? Register</div>
    </div>
</div>

<!-- Payment Modal -->
<div id="payment-modal" class="payment-modal">
    <div class="payment-box">
        <h3>‚ö° Payment Required</h3>
        <div id="payment-type-display" style="color:#00ff00; margin-bottom:1rem;">Barcode Generation - $10</div>
        <div class="payment-amount" id="payment-amount-display">$10.00 USD</div>
        
        <!-- Payment Method Tabs -->
        <div style="display:flex; gap:0.5rem; margin:1rem 0;">
            <button class="payment-tab active" id="tab-btc">‚Çø Bitcoin</button>
            <button class="payment-tab" id="tab-ln">‚ö° Lightning</button>
        </div>
        
        <!-- Bitcoin Payment -->
        <div id="payment-btc" class="payment-method active">
            <p style="color:#888; font-size:0.85rem; margin:0.5rem 0;">Send Bitcoin to:</p>
            <div class="btc-address" id="btc-address">bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh</div>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" id="btc-qr-img" class="btc-qr" alt="Bitcoin QR" style="display:block;" loading="lazy">
        </div>
        
        <!-- Lightning Payment -->
        <div id="payment-ln" class="payment-method" style="display:none;">
            <p style="color:#888; font-size:0.85rem; margin:0.5rem 0;">Pay with Lightning Network:</p>
            <div class="btc-address" id="ln-invoice" style="font-size:0.65rem; word-break:break-all;">lnbc1p5hunjvdqdgdshx6pqg9c8qpp5qxq5vvgl90mq7npt0xn75358hgqjtfzerkd2fd6e2yesc8eplcwqsp5vwv5q4ahupz0jaf9h332d858rhz0nm5h8uwcp9l8qkl9rs4chths9qrsgqcqpcxqy8ayqrzjqfzhphca8jlc5zznw52mnqxsnymltjgg3lxe4ul82g42vw0jpkgkwz6p3yqqt9sqqqqqqqqqqqqqqqqq9grzjqv06k0m23t593pngl0jt7n9wznp64fqngvctz7vts8nq4tukvtljqztad5qqrdqqqcqqqqqqqqqqqqqq9gdyq7w0j9pgnd3cnypsvq67lne8lcxzfxda3zlkwtsw8fm8n3pp79lsyxmemdnnhsgev7zuhce44mk3x3naxmwf9ygnnglmw9userg6sq8g9w7n</div>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" id="ln-qr-img" class="btc-qr" alt="Lightning QR" style="display:block;" loading="lazy">
            <p style="color:#ff9900; font-size:0.75rem; margin-top:0.5rem;">‚ö° Instant confirmation with Lightning!</p>
        </div>
        
        <p style="color:#888; font-size:0.8rem; margin-top:1rem;">Payment confirms automatically</p>
        <button class="payment-close" id="btn-close-payment">Close</button>
        <button class="payment-close" id="btn-simulate-payment" style="background:#003300; border-color:#00ff00; color:#00ff00; margin-left:0.5rem;">I've Paid</button>
    </div>
</div>

<header>
    <div class="header-left">
        <div class="header-logo-wrap">
            <img id="page-logo" src="assets/logo.png" alt="DO IT RIGHT">
            <div id="logo-smoke" class="smoke-container" aria-hidden="true"></div>
        </div>
        <div class="header-title">
            <h1>DO IT RIGHT RESOURCES</h1>
            <div class="subtitle">Barcode Generator | AAMVA Compliant</div>
        </div>
    </div>
    <div class="header-user" id="header-user" style="display:none;">
        <div class="header-user-info">
            Logged in as: <span class="header-user-email" id="user-email-display"></span>
        </div>
        <button class="btn-logout" id="btn-main-logout">Logout</button>
    </div>
</header> 

<main class="container">
    
    <div class="panel">
        <div class="panel-header">‚öôÔ∏è CONFIGURATION</div>
        
        <div class="config-grid">
            <div class="config-item">
                <label>State Profile:</label>
                <select id="profile-state">
                    <option value="FL">Florida (FL) - 636026</option>
                    <option value="CA">California (CA) - 636014</option>
                    <option value="TX">Texas (TX) - 636015</option>
                    <option value="NY">New York (NY) - 636001</option>
                    <option value="GA">Georgia (GA) - 636055</option>
                    <option value="NC">North Carolina (NC) - 636004</option>
                    <option value="PA">Pennsylvania (PA) - 636025</option>
                    <option value="OH">Ohio (OH) - 636023</option>
                    <option value="IL">Illinois (IL) - 636035</option>
                    <option value="AZ">Arizona (AZ) - 636039</option>
                    <option value="NV">Nevada (NV) - 636049</option>
                    <option value="CO">Colorado (CO) - 636020</option>
                    <option value="WA">Washington (WA) - 636045</option>
                    <option value="NJ">New Jersey (NJ) - 636036</option>
                    <option value="VA">Virginia (VA) - 636000</option>
                    <option value="MI">Michigan (MI) - 636032</option>
                    <option value="TN">Tennessee (TN) - 636053</option>
                    <option value="MD">Maryland (MD) - 636003</option>
                    <option value="MA">Massachusetts (MA) - 636002</option>
                    <option value="IN">Indiana (IN) - 636037</option>
                </select>
            </div>
            
            <div class="config-item">
                <label>AAMVA Version:</label>
                <select id="profile-aamva">
                    <option value="08">Version 08 (2013-2016)</option>
                    <option value="09" selected>Version 09 (2016-2020)</option>
                    <option value="10">Version 10 (2020+)</option>
                </select>
            </div>
            
            <div class="config-item">
                <label>Jurisdiction Version:</label>
                <select id="profile-jurisdiction">
                    <option value="01" selected>Version 01</option>
                    <option value="02">Version 02</option>
                </select>
            </div>
            
            <div class="config-item">
                <label>Current Configuration:</label>
                <div id="config-display" class="state-indicator">FL v09 Jur 01</div>
            </div>
            
            <div class="config-item" id="inventory-number-config">
                <label>Inventory Number (Audit Trail):</label>
                <input type="text" id="inventory-number" value="FLDMVAUDIT000001" style="width:100%; padding:0.5rem; background:#001a00; border:2px solid #ffff00; color:#ffff00; border-radius:4px; font-family:'Courier New',monospace; font-size:0.9rem;" maxlength="16" placeholder="16-char audit trail">
                <div style="color:#888; font-size:0.75rem; margin-top:0.25rem;">Appended after ZF close + CRC (16 chars)</div>
            </div>
        </div>
        
        <!-- CRYPTOGRAPHY TOGGLE SECTION -->
        <div class="crypto-toggle-section">
            <h3>üîê CRYPTOGRAPHY & CHECKSUM CONTROLS</h3>
            <div class="toggle-container">
                
                <div class="toggle-item" id="aes-toggle-panel">
                    <div class="toggle-switch">
                        <input type="checkbox" id="enable-aes256">
                        <label for="enable-aes256" class="toggle-label">
                            AES-256 Encryption
                            <span class="crypto-status off" id="aes-status">OFF</span>
                        </label>
                    </div>
                    <div class="toggle-description">
                        Encrypts sensitive fields (name, DOB, address) using AES-256-GCM.
                        Data becomes unreadable but maintains structure.
                    </div>
                </div>
                
                <div class="toggle-item" id="md5-toggle-panel">
                    <div class="toggle-switch">
                        <input type="checkbox" id="enable-md5">
                        <label for="enable-md5" class="toggle-label">
                            MD5 Checksum
                            <span class="crypto-status off" id="md5-status">OFF</span>
                        </label>
                    </div>
                    <div class="toggle-description">
                        Adds MD5 hash alongside CRC-16. Compare speed and collision resistance. (Legacy/compatibility use)
                    </div>
                </div>

                <div class="toggle-item" id="md5-api-key-ref" style="border-color:#00AAFF;">
                    <div class="toggle-switch">
                        <label class="toggle-label" style="margin-right:0.5rem; color:#00AAFF;">Admin API Key (reference)</label>
                        <input type="text" id="admin-api-key-input" placeholder="Paste admin API key" style="background:#001a00; border:2px solid #00AAFF; color:#00ff00; padding:0.4rem; border-radius:4px; width:260px;">
                        <button class="btn" id="btn-set-api-key">Set API Key</button>
                    </div>
                    <div class="toggle-description">
                        Optional reference key used to call the admin endpoint (<code>/admin/control?token=...)</code>. Stored locally in your browser for convenience.
                    </div>
                </div>


            </div>

                <div class="toggle-item" id="hmac-toggle-panel" style="border-color:#00CC88;">
                    <div class="toggle-switch">
                        <input type="checkbox" id="enable-hmac">
                        <label for="enable-hmac" class="toggle-label">
                            HMAC-SHA256 (Sign Payload)
                            <span class="crypto-status off" id="hmac-status">OFF</span>
                        </label>
                    </div>
                    <div class="toggle-description">
                        Sign the canonical payload with HMAC-SHA256 and append the 32-byte MAC before padding. Recommended for production integrity. Use <strong>Generate Key</strong> or import a hex key.
                    </div>
                    <div style="margin-top:0.75rem; display:flex; gap:0.5rem; align-items:center;">
                        <input type="text" id="hmac-key-hex" placeholder="Import key (hex) or generate" style="background:#001a00; border:2px solid #00CC88; color:#00ff00; padding:0.4rem; border-radius:4px; width:360px;">
                        <button class="btn" id="btn-import-hmac-key">Import Key</button>
                        <button class="btn" id="btn-generate-hmac-key">Generate Key</button>
                    </div>
                    <div style="margin-top:0.5rem; color:#ccffdd; font-size:0.85rem;">Key ID: <span id="hmac-key-id">(none)</span></div>
                </div>

                <div class="toggle-item" id="admin-control-panel" style="border-color:#00FFFF;">
                    <div class="toggle-switch">
                        <input type="password" id="admin-token-input" placeholder="Enter admin token" style="padding:0.4rem;">
                        <button class="btn" id="btn-admin-unlock">üîí Unlock Admin</button>
                        <span class="crypto-status off" id="admin-status">ADMIN OFF</span>
                    </div>
                    <div class="toggle-description">
                        Admin control panel. You can also validate via an API endpoint at <code>/admin/control?token=...</code> if your server implements it. For local control the token is <code>3100-31-3100</code> (hardcoded per request).
                    </div>
                </div>

            <div id="encryption-key-display" style="display: none; margin-top: 1rem; padding: 1rem; background: #0a0a0a; border: 2px solid #ff00ff; border-radius: 6px;">
                <strong style="color: #ff00ff;">üîë Encryption Key (Session):</strong>
                <div style="color: #ffff00; font-family: 'Courier New', monospace; word-break: break-all; margin-top: 0.5rem;" id="aes-key-display"></div>
                <div style="color: #cc99ff; font-size: 0.85rem; margin-top: 0.5rem;">
                    ‚ö†Ô∏è Key changes each session. In production, use secure key management!
                </div>
            </div>
        </div>
        
        <div class="legend">
            <strong>Field Inclusion Legend:</strong><br>
            <div class="legend-item">
                <span class="legend-color" style="background: #ffff00;"></span>
                <span>REQUIRED (Must have data)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #ff8800;"></span>
                <span>ALWAYS INCLUDE (Even if empty)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #00ff00;"></span>
                <span>OPTIONAL (Omit if empty)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #ff00ff;"></span>
                <span>üîê ENCRYPTED (AES-256)</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="btn-generate">‚ö° GENERATE BARCODE</button>
            <button class="btn" id="btn-validate">‚úì VALIDATE</button>
            <button class="btn" id="btn-download">üíæ DOWNLOAD PNG</button>
            <button class="btn" id="btn-reset">üîÑ RESET DATA</button>
            <button class="btn" id="btn-test">üß™ RUN TESTS</button>
        </div>
        
        <div class="checkbox-wrapper">
            <input type="checkbox" id="strict-mode" checked>
            <label for="strict-mode">Strict DMV Validation Mode</label>
        </div>
        
        <div id="validation-status"></div>
    </div>
    
    <div class="layout-grid">
        
        <!-- Admin Control Panel - only shown when logged in as admin -->
        <div class="panel" id="secure-panel" style="display:none;">
            <div class="panel-header">üîê ADMIN CONTROL CENTER</div>
            <div id="secure-actions">
                <!-- Admin Nav Tabs -->
                <div style="display:flex; gap:0.5rem; margin-bottom:1rem; flex-wrap:wrap;">
                    <button class="btn admin-tab active" id="admin-tab-payments">üí∞ Payments</button>
                    <button class="btn admin-tab" id="admin-tab-audit">üìã Audit Log</button>
                    <button class="btn admin-tab" id="admin-tab-users">üë• Users</button>
                    <button class="btn admin-tab" id="admin-tab-balances">üí≥ Balances</button>
                </div>

                <div id="secure-content">
                    <!-- Payment Processor Panel -->
                    <div id="admin-payments" class="admin-section">
                        <h4 style="color:#ff9900;">üí∞ Payment Processor</h4>
                        <div style="background:#001a00; border:2px solid #ff9900; border-radius:6px; padding:1rem; margin-bottom:1rem;">
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                                <div>
                                    <label style="color:#ffff00; font-size:0.85rem;">Bitcoin Address</label>
                                    <input type="text" id="admin-btc-address" value="bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh" style="width:100%; padding:0.5rem; background:#000; border:2px solid #00ff00; color:#00ff00; border-radius:4px; font-family:monospace; font-size:0.8rem;">
                                </div>
                                <div>
                                    <label style="color:#ffff00; font-size:0.85rem;">Barcode Price ($)</label>
                                    <input type="number" id="admin-barcode-price" value="10" style="width:100%; padding:0.5rem; background:#000; border:2px solid #00ff00; color:#00ff00; border-radius:4px;">
                                </div>
                            </div>
                            <div style="margin-top:1rem;">
                                <label style="color:#ffff00; font-size:0.85rem;">Lightning Invoice</label>
                                <textarea id="admin-ln-invoice" rows="3" style="width:100%; padding:0.5rem; background:#000; border:2px solid #ff9900; color:#ff9900; border-radius:4px; font-family:monospace; font-size:0.7rem;">lnbc1p5hunjvdqdgdshx6pqg9c8qpp5qxq5vvgl90mq7npt0xn75358hgqjtfzerkd2fd6e2yesc8eplcwqsp5vwv5q4ahupz0jaf9h332d858rhz0nm5h8uwcp9l8qkl9rs4chths9qrsgqcqpcxqy8ayqrzjqfzhphca8jlc5zznw52mnqxsnymltjgg3lxe4ul82g42vw0jpkgkwz6p3yqqt9sqqqqqqqqqqqqqqqqq9grzjqv06k0m23t593pngl0jt7n9wznp64fqngvctz7vts8nq4tukvtljqztad5qqrdqqqcqqqqqqqqqqqqqq9gdyq7w0j9pgnd3cnypsvq67lne8lcxzfxda3zlkwtsw8fm8n3pp79lsyxmemdnnhsgev7zuhce44mk3x3naxmwf9ygnnglmw9userg6sq8g9w7n</textarea>
                            </div>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-top:1rem;">
                                <div>
                                    <label style="color:#ffff00; font-size:0.85rem;">HMAC Import Price ($)</label>
                                    <input type="number" id="admin-hmac-price" value="5" style="width:100%; padding:0.5rem; background:#000; border:2px solid #00ff00; color:#00ff00; border-radius:4px;">
                                </div>
                                <div style="display:flex; align-items:flex-end;">
                                    <button class="btn btn-primary" id="btn-save-payment-settings" style="width:100%;">üíæ Save Settings</button>
                                </div>
                            </div>
                        </div>
                        <div style="background:#0a0a0a; border:2px solid #00ff00; border-radius:6px; padding:1rem;">
                            <h5 style="color:#00ff00; margin-bottom:0.5rem;">üìä Payment Stats</h5>
                            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:1rem; text-align:center;">
                                <div style="background:#001a00; padding:0.75rem; border-radius:4px;">
                                    <div style="color:#00ff00; font-size:1.5rem; font-weight:700;" id="stat-total-payments">0</div>
                                    <div style="color:#888; font-size:0.75rem;">Total Payments</div>
                                </div>
                                <div style="background:#001a00; padding:0.75rem; border-radius:4px;">
                                    <div style="color:#ffff00; font-size:1.5rem; font-weight:700;" id="stat-total-revenue">$0</div>
                                    <div style="color:#888; font-size:0.75rem;">Revenue</div>
                                </div>
                                <div style="background:#001a00; padding:0.75rem; border-radius:4px;">
                                    <div style="color:#ff9900; font-size:1.5rem; font-weight:700;" id="stat-pending">0</div>
                                    <div style="color:#888; font-size:0.75rem;">Pending</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Log Panel -->
                    <div id="admin-audit" class="admin-section" style="display:none;">
                        <h4 style="color:#00ffff;">üìã Audit Trail</h4>
                        <div style="background:#001a00; border:2px solid #00ffff; border-radius:6px; padding:1rem;">
                            <div style="display:flex; gap:0.5rem; margin-bottom:1rem;">
                                <input type="text" id="audit-search" placeholder="Search logs..." style="flex:1; padding:0.5rem; background:#000; border:2px solid #00ffff; color:#00ff00; border-radius:4px;">
                                <select id="audit-filter" style="padding:0.5rem; background:#000; border:2px solid #00ffff; color:#00ffff; border-radius:4px;">
                                    <option value="all">All Events</option>
                                    <option value="login">Logins</option>
                                    <option value="payment">Payments</option>
                                    <option value="generate">Generations</option>
                                    <option value="error">Errors</option>
                                </select>
                                <button class="btn" id="btn-refresh-audit">üîÑ</button>
                                <button class="btn" id="btn-export-audit">üì• Export</button>
                            </div>
                            <div id="audit-log-list" style="max-height:300px; overflow-y:auto; font-family:monospace; font-size:0.8rem; color:#00ff00;">
                                <div class="audit-entry" style="padding:0.5rem; border-bottom:1px solid #003333;">
                                    <span style="color:#888;">[Loading...]</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Panel -->
                    <div id="admin-users" class="admin-section" style="display:none;">
                        <h4 style="color:#ffff00;">üë• Registered Users</h4>
                        <table id="secure-users-table" style="width:100%; border-collapse:collapse; color:#00ff00; font-size:0.85rem;"></table>
                        <div style="margin-top:0.5rem; display:flex; gap:0.5rem;">
                            <input id="new-user-email" placeholder="email" style="padding:0.4rem; flex:1; background:#000; border:2px solid #00ff00; color:#00ff00; border-radius:4px;">
                            <input id="new-user-pass" placeholder="password" type="password" style="padding:0.4rem; flex:1; background:#000; border:2px solid #00ff00; color:#00ff00; border-radius:4px;">
                            <button class="btn" id="btn-create-user">‚ûï Create</button>
                        </div>
                    </div>

                    <!-- Balances Panel -->
                    <div id="admin-balances" class="admin-section" style="display:none;">
                        <h4 style="color:#ff00ff;">üí≥ Account Balances & Credits</h4>
                        <div id="secure-balances-list" style="font-family:monospace; color:#00ff00; max-height:200px; overflow-y:auto; background:#001a00; padding:1rem; border-radius:6px; margin-bottom:1rem;"></div>
                        <div style="display:flex; gap:0.5rem;">
                            <input id="credit-email" placeholder="email" style="padding:0.4rem; flex:1; background:#000; border:2px solid #ff00ff; color:#ff00ff; border-radius:4px;">
                            <input id="credit-amount" placeholder="credits" type="number" style="padding:0.4rem; width:80px; background:#000; border:2px solid #ff00ff; color:#ff00ff; border-radius:4px;">
                            <button class="btn" id="btn-credit" style="background:#330033; border-color:#ff00ff; color:#ff00ff;">üí∞ Add Credits</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">üìù EDITABLE FIELDS</div>
            <div id="state-info" class="alert alert-info" style="margin-bottom: 1rem;"></div>
            <div id="field-container"></div>
        </div>
        
        <div class="panel">
            <div class="panel-header">üîß OUTPUT & ANALYSIS</div>
            
            <div id="checksum-comparison-display"></div>
            
            <h3 style="margin-bottom: 0.5rem; color: #ffff00;">Protocol Structure</h3>
            <div class="hex-display" id="protocol-analysis">Awaiting generation...</div>
            
            <h3 style="margin: 1.5rem 0 0.5rem; color: #ffff00;">Binary Hex Dump</h3>
            <div class="hex-display" id="hex-preview">Awaiting generation...</div>
            
            <div id="barcode-output"></div>
        </div>
        
    </div>
    
</main>

<!-- Help Chat Widget -->
<div class="help-widget" id="help-widget">
    <div class="help-toggle" id="help-toggle">
        <img src="assets/logo.png" alt="Help" id="help-avatar" loading="lazy">
        <div class="chat-smoke" id="chat-smoke"></div>
    </div>
</div>

<div class="help-panel" id="help-panel">
    <div class="help-panel-header">
        <img src="assets/logo.png" alt="Assistant" loading="lazy">
        <span>DO IT RIGHT Assistant</span>
    </div>
    <div class="help-messages" id="help-messages">
        <div class="help-msg bot">üëã Hi! I'm your barcode assistant. Ask me anything about generating compliant barcodes!</div>
    </div>
    <div class="help-input-area">
        <input type="text" id="help-input" placeholder="Type your question...">
        <button id="btn-help-send">Send</button>
    </div>
</div>

<footer>
    <div style="font-weight: 700; margin-bottom: 0.5rem;">
        DO IT RIGHT RESOURCES - Barcode Generator
    </div>
    <div>
        Multi-State Support | AAMVA Compliant | Secure Generation
    </div>
</footer>

<script src="app.js"></script>
</body>
</html>